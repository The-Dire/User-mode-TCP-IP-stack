## 利用libpcap捕获网络数据包与其他低级别网络包教程

libpcap的源码可以从 https://www.tcpdump.org/ 下载。

本教程至少假定您对网络有一个粗略的了解。例如，数据包是什么，数据包是如何发送的，网络四层模型。这个教程重点关心数据链路层的事情。

### 什么是包捕获

包捕获，简单的意思是“抓取包”。

实际上，我要在这里试图做的是访问操作系统提供的底层设施，这样我们就可以以原始形式获取包。例如，假设电脑的网卡从网络中获取了一个数据包。一旦数据包被传递给操作系统，操作系统必须确定它是什么类型的数据包，为了做到这一点，它会剥去数据包的以太网头并查看下一层。也许是ip包…操作系统现在必须去掉IP报头并确定它是哪种类型的IP包。最后，假设数据包是a
UDP包，UDP头被剥离，包的有效负载被移交给应用程序，该包被发送(注意，这是一个粗略的简化的收发包版本，但我试图说明一点)。封包捕获允许我们拦截任何被网络设备看到的封包，并捕获它的全部头和全部!无论发送到哪个端口，甚至是哪个主机!

### libpcap是什么

libpcap 是“提供对操作系统提供的底层包捕获设施的实现独立的访问”的一个库。libpcap是我们用来直接从网卡中获取数据包的库。这里需要指出一点，还有其他方法可以做到这一点，包括BPF (Berkeley Packet Filter)和DLPI (Data Link)和SOCKET_PACKET类型的套接字(仅适用于Linux)。

### libpcap基础

本节中的所有代码都假设包是处于数据链路层的遵循以太网协议的包。在centos7中配置libpcap库直接 `yum install libpcap-devel` 即可。

